<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>CoinKrazy.com - Social Casino & Sweepstakes Games</title>
    <meta
      name="description"
      content="CoinKrazy.com - Play free social casino games, slots, bingo, and sweepstakes. Win Gold Coins and Sweeps Coins. No purchase necessary."
    />
    <meta
      name="keywords"
      content="social casino, sweepstakes, slots, bingo, free games, gold coins, sweeps coins, CoinKrazy"
    />
    <meta
      property="og:title"
      content="CoinKrazy.com - Social Casino & Sweepstakes Games"
    />
    <meta
      property="og:description"
      content="Play free social casino games and win real prizes with sweepstakes coins!"
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://coinkrazy.com" />
    <meta
      property="og:image"
      content="https://coinkrazy.com/icons/icon-512x512.png"
    />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#ffd700" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="CoinKrazy" />
    <meta name="msapplication-TileColor" content="#1a1a2e" />
    <meta name="msapplication-TileImage" content="/icons/icon-144x144.png" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="CoinKrazy" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- PWA Icons -->
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/icons/icon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/icons/icon-16x16.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/icons/icon-180x180.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="/icons/icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="/icons/icon-144x144.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="/icons/icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="/icons/icon-114x114.png"
    />
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/icon-57x57.png" />

    <!-- Splash Screens for iOS -->
    <link
      rel="apple-touch-startup-image"
      href="/splash/iphone5_splash.png"
      media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/splash/iphone6_splash.png"
      media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/splash/iphoneplus_splash.png"
      media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/splash/iphonex_splash.png"
      media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/splash/ipad_splash.png"
      media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/splash/ipadpro1_splash.png"
      media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/splash/ipadpro2_splash.png"
      media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)"
    />
  </head>

  <body>
    <div id="root"></div>

    <script type="module" src="/client/App.tsx?v=1755164000000"></script>

    <!-- Service Worker Registration -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              console.log("SW registered: ", registration);

              // Check for updates
              registration.addEventListener("updatefound", () => {
                const newWorker = registration.installing;
                newWorker.addEventListener("statechange", () => {
                  if (
                    newWorker.state === "installed" &&
                    navigator.serviceWorker.controller
                  ) {
                    // New content is available, prompt user to refresh
                    if (confirm("New version available! Refresh to update?")) {
                      window.location.reload();
                    }
                  }
                });
              });
            })
            .catch((registrationError) => {
              console.log("SW registration failed: ", registrationError);
            });
        });

        // Listen for messages from service worker
        navigator.serviceWorker.addEventListener("message", (event) => {
          if (event.data && event.data.type === "UPDATE_AVAILABLE") {
            if (confirm("New version available! Refresh to update?")) {
              window.location.reload();
            }
          }
        });
      }

      // PWA Install Prompt
      let deferredPrompt;
      window.addEventListener("beforeinstallprompt", (e) => {
        // Prevent Chrome 67 and earlier from automatically showing the prompt
        e.preventDefault();
        // Stash the event so it can be triggered later.
        deferredPrompt = e;

        // Show install button or banner
        showInstallPromotion();
      });

      function showInstallPromotion() {
        // Create install banner if it doesn't exist
        if (!document.getElementById("install-banner")) {
          const banner = document.createElement("div");
          banner.id = "install-banner";
          banner.innerHTML = `
            <div style="position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(45deg, #ffd700, #ffed4e); color: #1a1a2e; padding: 12px; text-align: center; z-index: 10000; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
              <span style="font-weight: bold; margin-right: 10px;">ðŸ“± Install CoinKrazy App for the best experience!</span>
              <button id="install-btn" style="background: #1a1a2e; color: #ffd700; border: none; padding: 8px 16px; border-radius: 4px; font-weight: bold; margin-right: 10px; cursor: pointer;">Install</button>
              <button id="close-banner" style="background: transparent; border: 1px solid #1a1a2e; color: #1a1a2e; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Later</button>
            </div>
          `;
          document.body.appendChild(banner);

          // Add event listeners
          document
            .getElementById("install-btn")
            .addEventListener("click", () => {
              // Hide the banner
              banner.style.display = "none";
              // Show the install prompt
              deferredPrompt.prompt();
              // Wait for the user to respond to the prompt
              deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === "accepted") {
                  console.log("User accepted the A2HS prompt");
                } else {
                  console.log("User dismissed the A2HS prompt");
                }
                deferredPrompt = null;
              });
            });

          document
            .getElementById("close-banner")
            .addEventListener("click", () => {
              banner.style.display = "none";
            });
        }
      }

      // Hide install promotion after app is installed
      window.addEventListener("appinstalled", (evt) => {
        console.log("App was installed");
        const banner = document.getElementById("install-banner");
        if (banner) {
          banner.style.display = "none";
        }
      });

      // Register for push notifications (optional)
      function requestNotificationPermission() {
        if ("Notification" in window && "serviceWorker" in navigator) {
          Notification.requestPermission().then((permission) => {
            if (permission === "granted") {
              console.log("Notification permission granted");
              // Subscribe to push notifications
              subscribeToPushNotifications();
            }
          });
        }
      }

      function subscribeToPushNotifications() {
        navigator.serviceWorker.ready
          .then((registration) => {
            // Subscribe to push notifications
            return registration.pushManager.subscribe({
              userVisibleOnly: true,
              applicationServerKey: urlBase64ToUint8Array(
                "YOUR_VAPID_PUBLIC_KEY_HERE",
              ),
            });
          })
          .then((subscription) => {
            console.log("Push subscription:", subscription);
            // Send subscription to server
            sendSubscriptionToServer(subscription);
          })
          .catch((error) => {
            console.log("Push subscription failed:", error);
          });
      }

      function urlBase64ToUint8Array(base64String) {
        const padding = "=".repeat((4 - (base64String.length % 4)) % 4);
        const base64 = (base64String + padding)
          .replace(/-/g, "+")
          .replace(/_/g, "/");

        const rawData = window.atob(base64);
        const outputArray = new Uint8Array(rawData.length);

        for (let i = 0; i < rawData.length; ++i) {
          outputArray[i] = rawData.charCodeAt(i);
        }
        return outputArray;
      }

      function sendSubscriptionToServer(subscription) {
        // Send push subscription to your server
        fetch("/api/push-subscribe", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(subscription),
        }).catch((error) => {
          console.error("Error sending subscription to server:", error);
        });
      }

      // Auto-request notification permission after user interaction
      document.addEventListener(
        "click",
        () => {
          if (Notification.permission === "default") {
            requestNotificationPermission();
          }
        },
        { once: true },
      );
    </script>
  </body>
</html>
